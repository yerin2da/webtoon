<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1화 마녀의 귀환</title>
    <link href="./css/common.css" rel="stylesheet">
    <!-- 폰트어썸 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <!-- jquery-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Swiper -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script src="/js/jquery.easing.1.3.js" type="text/javascript"></script>
    <link rel="stylesheet" href="../css/jquery.booklet.latest.css" />

    <script src="/js/jquery.booklet.latest.js"></script>
    <script src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.6.2/dist/dotlottie-wc.js"
    type="module"></script>
</head>
<body>
<div class="wrap">
    <div class="lottie_img_wrap">
        <dotlottie-wc
            id="introAnim"
            src="https://lottie.host/a5f1cad7-1a3e-4105-9168-dec688961643/qMuRvRIt5c.lottie"
            style="width: 100%;height: 100%"
            speed="1"
            autoplay
            loop
        >
        </dotlottie-wc>
    </div>

    <!--헤더-->
    <header>
        <div class="content">
            <!--제목-->
            <div class="tit_wrap">
                <div class="tit">위치 워치</div>
                <div class="bar">&nbsp;</div>
                <div class="sub_tit"><span class="ep_box">1화</span> 마녀의 귀환</div>
            </div>

            <!--이전화, 다음화-->
            <div class="episode_btn pc"></div>
        </div>

        <!--mob 위쪽 뷰어설정-->
        <div class="view_setting_toggle mob">
            <div class="view_setting_toggle_wrap">
                <div class="view_setting_btn">
                    <img src="./img/view_setting.svg" alt="뷰어설정">
                </div>
            </div>
        </div><!--.view_setting_toggle .mob end-->
    </header>

    <!--메인-->
    <main>
        <div class="content">
            <!--슬라이드-->
            <div id="slide"></div><!--기본, 페이드 슬라이드-->

            <div id="flip"></div><!--책넘김 슬라이드-->
        </div>
    </main>

    <!--pc 오른쪽 뷰어설정-->
    <div class="view_setting_toggle pc">
        <div class="view_setting_toggle_wrap">
            <div class="view_setting_btn">
                <img src="./img/view_setting.svg" alt="뷰어설정">
            </div>
            <div class="go_first">
                <img src="./img/reset.svg" alt="처음으로 돌아가기">
            </div>
        </div>
    </div>

    <!--뷰어 설정-->
    <div id="view_setting"></div>

    <!--푸터-->
    <footer>
        <div class="content">
            <!--설정-->
            <div class="view_setting_toggle mob">
                <div class="view_setting_toggle_wrap">
                    <div class="go_first">
                        <img src="./img/reset.svg" alt="처음으로 돌아가기">
                    </div>

                </div>
            </div><!--.view_setting_toggle .mob end-->

            <!--이전화, 다음화-->
            <div class="episode_btn mob"></div>
        </div>
    </footer>

</div><!--.wrap end-->

<script>
    let swiper; // 전역에 선언

    //이전화, 다음화
    $(".episode_btn").load("episode_btn.html");

    //슬라이드
    $("#slide").load("slide.html");

    //뷰어설정
    $("#view_setting").load("view_setting.html");

    //뷰어설정
    $('#view_setting').hide();
    $('.view_setting_btn').click(function (){
        $('#view_setting').fadeIn(300);//0.3초
    });
    $(document).on('click', '#view_setting .view_setting_close_btn',function (){
        $('#view_setting').fadeOut(300);//0.3초
    });

    // Swiper 초기화
    $("#slide").load("slide.html", function () {
        slide_reset('');//기본 슬라이드
        intro_animation();
    });

    function intro_animation(){
        const intro = $('.lottie_img_wrap');

        // 3초 후 서서히 사라지기
        setTimeout(() => {
            intro.fadeOut(500); // 0.5초 동안 사라짐
        }, 3000); // 3초 후 실행
    }

    $('.go_first').click(function (){
        swiper.slideToLoop(0);//슬라이드 맨 처음으로 이동
    });
    //넘김효과 선택
    $(document).on('change', 'input[name="effect-input"]', function () {
        // 현재 선택된 것만 checked
        $('input[name="effect-input"]').prop('checked', false);
        $(this).prop('checked', true);

        let selectedEffect = '';//넘김 효과
        if (this.id === 'fade-input') {//페이드
            selectedEffect = 'fade';

            $("#slide").load("slide.html", function () {
                slide_reset(selectedEffect);
                $("#flip").hide();
                $("#slide").show();
                $('input[name="fade-input"]').prop('checked', true);
            });

        } else if (this.id === 'flip-input') {// 플립
            $("#flip").load("slide2.html", function() {
                $("#slide").hide();
                $("#flip").show();
                flip_slide();
            });

        } else {
            selectedEffect = ''; // 기본 슬라이드
            // Swiper 초기화
            $("#slide").load("slide.html", function () {
                slide_reset(selectedEffect);
                $("#flip").hide();
                $("#slide").show();
            });
        }
    });

    //슬라이드 초기설정
    function slide_reset(selectedEffect){
        const progressCircle = document.querySelector(".autoplay-progress svg");
        const progressContent = document.querySelector(".autoplay-progress span");

         swiper = new Swiper(".mySwiper", {
            spaceBetween: 30,
            effect: selectedEffect, // 선택된 효과 적용
            centeredSlides: true,
            pagination: {
                el: ".swiper-pagination-bullets",
                clickable: true
            },
            scrollbar: {
                el: ".swiper-scrollbar"
            },
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev"
            },
            // 마우스휠
            mousewheel: {
                invert: false,    // false: 아래로 → 다음 슬라이드
                sensitivity: 1,   // 감도
            },
            // 키보드
            keyboard: {
                enabled: true,    // 키보드 이벤트 활성화
                onlyInViewport: true, // 화면 안에서만 작동
            },
            on: {
                slideChange: function () {
                    let progress = ((this.realIndex + 1) / this.slides.length) * 100;
                    document.querySelector(".swiper-pagination-progress").style.width = progress + "%";
                }
            }
        });
    }

    function flip_slide() {
         swiper = new Swiper(".mySwiper.perspective", {
            slidesPerView: 1,
            spaceBetween: 0,
            rtl: true,
            centeredSlides: false,
            speed: 1000,
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
            pagination: {
                el: ".swiper-pagination-bullets",
                clickable: true,
            },
            mousewheel: {
                invert: false,
                sensitivity: 1,
            },
            keyboard: {
                enabled: true,
                onlyInViewport: true,
            },
            effect: "creative",
            creativeEffect: {
                prev: {
                    shadow: false,
                    translate: ["-100%", 0, -400],//x축, y축, z축
                    rotate: [0, -180, 0],
                },
                next: {
                    shadow: false,
                    // translate: ["-100%", 0, -400],
                    rotate: [0, 0, 0],
                },
            },
            on: {
                slideChange: function () {
                    const progressBar = document.querySelector("#flip .swiper-pagination-progress");
                    if (progressBar) {
                        progressBar.style.width = ((this.realIndex + 1) / this.slides.length * 100) + "%";
                    }
                },
            }
        });
    }

</script>

<!--<script>-->
<!--    //ios safari height 100vh-->
<!--    window.addEventListener("DOMContentLoaded", function (ev) {-->
<!--        const { innerHeight } = window;-->
<!--        document.documentElement.style.setProperty("&#45;&#45;app-height",`${innerHeight}px`);-->
<!--    });-->
<!--</script>-->
</body>
</html>